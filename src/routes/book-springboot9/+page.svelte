<!-- auto-generated by QWER -->
<script lang="ts">
  /* eslint-disable @typescript-eslint/ban-ts-comment */
  // @ts-nocheck
  import Post from '$lib/layouts/post.svelte';
  import ImgZoom from '$lib/components/image_zoom.svelte';
  import Video from '$lib/components/video.svelte';
  import CodeCopy from '$lib/components/code_copy.svelte';
  import InfoBox from '$lib/components/info_box.svelte';
</script>

<Post>
  <article slot="post_content">
    <h1 id="part-11"><a href="#part-11">Part 11. 액추에이어 활용하기</a></h1>
    <p>
      애플리케이션을 개발하는 단계를 지나 운영 단계에 접어들면 애플리케이션이 정상적으로 동작하는지 모니터링하는 환경을
      구축하는 것이 매우 중요해집니다. 스프링 부트 액추에이터는 HTTP 엔드포인트나 <code class="inline-code-block">
        JMX
      </code>
      를 활용해 애플리케이션을 모니터링하고 관리할 수 있는 기능을 제공합니다. 이번 장에서는 액추에이터의 환경을 설정하고
      활용하는 방법을 다룰 예정입니다.
    </p>
    <InfoBox statusType="tip" statusName="JMX란?">
      <p>
        JMX(Java Management Extension)는 실행 중인 애플리케이션의 상태를 모니터링하고 설정을 변경할 수 있게 해주는
        API입니다. JMX를 통해 리소스 관리를 하려면 MBean(Manged Bean)을 생성해야 합니다.
      </p>
    </InfoBox>
    <h2 id=""><a href="#">액추에이터 종속성 추가</a></h2>
    <p>
      액추에이터를 사용하려면 <code class="inline-code-block">spring-boot-starter-actuator</code>
       모듈을 추가해야 합니다.
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-groovy">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">dependencies <span class="token punctuation">{</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    implementation <span class="token string">'org.springframework.boot:spring-boot-starter-actuator'</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">}</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <h2 id=""><a href="#">엔드포인트</a></h2>
    <p>
      엑추에이터의 엔드포인트는 애플리케이션의 모니터링을 사용하는 경로입니다. 스프링 부트에는 여러 내장 엔드포인트가
      포함돼 있으며, 커스텀 엔드포인트를 추가할 수도 있습니다. 액추에이터를 추가하면 기본적으로 엔드포인트 URL로
      /actuator가 추가되며 이 뒤에 경로를 추가해 상세 내역에 접근합니다. 만약 /actuator가 아닌 다른 경로를 사용하고
      싶다면 설정파일을 통해 변경할 수 있습니다.
    </p>
    <div class="code-block titled">
      <h2 class="code-title">application.yml</h2>
      <CodeCopy>
        <pre><code
            class="language-yaml">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token key atrule">management</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token key atrule">web</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">      <span class="token key atrule">base-path</span><span class="token punctuation">:</span> /custom<span class="token punctuation">-</span>path</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>자주 활용되는 엔드포인트는 다음과 같습니다.</p>
    <table>
      <thead>
        <tr>
          <th>엔드포인트</th>
          <th>설명</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code class="inline-code-block">auditevents</code></td>
          <td>호출된 Audit 이벤트 정보를 확인할 수 있습니다. AuditEventRepository를 구현한 빈이 있어야 합니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">beans</code></td>
          <td>애플리케이션에 등록된 빈 정보를 확인할 수 있습니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">caches</code></td>
          <td>사용 가능한 캐시 정보를 확인할 수 있습니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">conditions</code></td>
          <td>자동 설정이 적용된 조건을 확인할 수 있습니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">configprops</code></td>
          <td>@ConfigurationProperties로 정의한 설정 정보를 확인할 수 있습니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">env</code></td>
          <td>애플리케이션에서 사용할 수 있는 환경 속성을 표시합니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">health</code></td>
          <td>애플리케이션의 상태 정보를 확인할 수 있습니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">httptrace</code></td>
          <td>
            가장 최근에 이뤄진 100건의 HTTP 요청/응답 정보를 확인할 수 있습니다. HttpTraceRepository를 구현한 빈이
            있어야 합니다.
          </td>
        </tr>
        <tr>
          <td><code class="inline-code-block">info</code></td>
          <td>애플리케이션의 정보를 확인할 수 있습니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">loggers</code></td>
          <td>애플리케이션의 로거 구성을 표시하고 수정합니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">metrics</code></td>
          <td>애플리케이션의 메트릭 정보를 확인할 수 있습니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">mappings</code></td>
          <td>애플리케이션의 URL 매핑 정보를 확인할 수 있습니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">quartz</code></td>
          <td>Quartz 스케줄러의 상태 정보를 확인할 수 있습니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">scheduledtasks</code></td>
          <td>스케줄러의 상태 정보를 확인할 수 있습니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">sessions</code></td>
          <td>HTTP 세션 정보를 확인하거나 삭제할 수 있습니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">shutdown</code></td>
          <td>애플리케이션을 종료합니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">startup</code></td>
          <td>
            애플리케이션의 시작 과정에서 로드된 빈 정보를 확인할 수 있습니다. BufferingApplicationStartup을 사용해야
            합니다.
          </td>
        </tr>
        <tr>
          <td><code class="inline-code-block">threaddump</code></td>
          <td>스레드 덤프를 수행합니다.</td>
        </tr>
      </tbody>
    </table>
    <p>만약 SpringMVC, WebFlux, Jersey을 사용한다면 추가로 다음과 같은 엔드포인트를 사용할 수 있습니다.</p>
    <table>
      <thead>
        <tr>
          <th>엔드포인트</th>
          <th>설명</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code class="inline-code-block">heapdump</code></td>
          <td>힙 덤프 파일을 반환합니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">jolokia</code></td>
          <td>
            Jolokia가 클래스패스에 있을 때 HTTP를 통해 JMX 빈을 표시합니다. jolokia-core 모듈에 대한 의존성 추가가
            필요하며, WebFlux에서는 사용할 수 없습니다
          </td>
        </tr>
        <tr>
          <td><code class="inline-code-block">logfile</code></td>
          <td>logging.file.name 또는 logging.file.path 속성에 지정된 파일을 반환합니다.</td>
        </tr>
        <tr>
          <td><code class="inline-code-block">Prometheus</code></td>
          <td>
            Prometheus 서버에서 스크랩할 수 있는 형식으로 메트릭을 표시합니다. micrometer-registry-prometheus 모듈에
            대한 의존성 추가가 필요합니다.
          </td>
        </tr>
      </tbody>
    </table>
    <p>엔드포인트 활성화 여부와 노출 여부도 설정파일을 통해 변경할 수 있습니다.</p>
    <div class="code-block titled">
      <h2 class="code-title">application.yml</h2>
      <CodeCopy>
        <pre><code
            class="language-yaml">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token key atrule">management</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token key atrule">shutdown</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token key atrule">cache</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      비활성화된 엔드포인트는 애플리케이션 컨텍스트에서 완전히 제거됩니다. 위 설정을 shutdown 기능을 활성화하고 cache
      기능을 비활성화하겠다는 의미입니다.
    </p>
    <p>또한 액추에이터 설정을 통해 기능 활성화/비활성화가 아니라 엔드포인트의 노출 여부만 설정하는 것도 가능합니다.</p>
    <div class="code-block titled">
      <h2 class="code-title">application.yml</h2>
      <CodeCopy>
        <pre><code
            class="language-yaml">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token comment">## 엔드포인트 노출 설정</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token comment">## HTTP 설정</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token key atrule">management</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token key atrule">web</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">      <span class="token key atrule">exposure</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token key atrule">include</span><span class="token punctuation">:</span> *</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token key atrule">exclude</span><span class="token punctuation">:</span> threaddump<span class="token punctuation">,</span>heapdump</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token comment">## JMX 설정</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token key atrule">management</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token key atrule">jmx</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">      <span class="token key atrule">exposure</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token key atrule">include</span><span class="token punctuation">:</span> *</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token key atrule">exclude</span><span class="token punctuation">:</span> threaddump<span class="token punctuation">,</span>heapdump</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <h2 id=""><a href="#">액추에이터 기능 살펴보기</a></h2>
    <h3 id="info"><a href="#info">애플리케이션 기본 정보(/info)</a></h3>
    <div class="code-block titled">
      <h2 class="code-title">application.yml</h2>
      <CodeCopy>
        <pre><code
            class="language-yaml">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token key atrule">info</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token key atrule">organization</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    name<span class="token punctuation">:</span>wikibooks</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token key atrule">contact</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    email<span class="token punctuation">:</span>test@gmail.com</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    phoneNumber<span class="token punctuation">:</span>010<span class="token punctuation">-</span>1234<span class="token punctuation">-</span><span class="token number">5678</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      위 예제처럼 설정하고 <code class="inline-code-block">http://localhost:8080/actuator/info</code>
      로 접근하면 다음과 같은 결과를 확인할 수 있습니다.
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-json">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">{</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token property">"organization"</span><span class="token operator">:</span> <span class="token punctuation">{</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"wikibooks"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token punctuation">}</span><span class="token punctuation">,</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token property">"contact"</span><span class="token operator">:</span> <span class="token punctuation">{</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token property">"email"</span><span class="token operator">:</span> <span class="token string">"test@gmail.com"</span><span class="token punctuation">,</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token property">"phoneNumber"</span><span class="token operator">:</span> <span class="token string">"010-1234-5678"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token punctuation">}</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">}</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <h3 id="health"><a href="#health">애플리케이션 상태(/health)</a></h3>
    <p>
      <code class="inline-code-block">http://localhost:8080/actuator/health</code>
      로 접근하면 다음과 같은 결과를 확인할 수 있습니다.
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-json">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">{</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token property">"status"</span><span class="token operator">:</span> <span class="token string">"UP"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">}</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>status는 다음과 같은 값으로 표시됩니다.</p>
    <ul>
      <li>
        <code class="inline-code-block">UP</code>
        : 애플리케이션의 상태가 정상입니다.
      </li>
      <li>
        <code class="inline-code-block">DOWN</code>
        : 애플리케이션의 상태가 비정상입니다.
      </li>
      <li>
        <code class="inline-code-block">OUT_OF_SERVICE</code>
        : 애플리케이션이 서비스를 제공할 수 없는 상태입니다.
      </li>
      <li>
        <code class="inline-code-block">UNKNOWN</code>
        : 애플리케이션의 상태를 확인할 수 없습니다.
      </li>
    </ul>
    <p>이 결과들은 주로 네트워크 계층 중 L4(Loadbalancing) 레벨에서 사용됩니다.</p>
    <h3 id="beans"><a href="#beans">빈 정보 확인(/beans)</a></h3>
    <p>
      <code class="inline-code-block">http://localhost:8080/actuator/beans</code>
      로 접근하면 스프링 컨테이너에 등록된 빈의 정보들을 확인할 수 있습니다.
    </p>
    <h3 id=""><a href="#">그 외 엔드포인트</a></h3>
    <p>
      액추에이터의 엔드포인트는 위에서 설명한 것 외에도 다양한 기능을 제공합니다. 자세한 내용은 <a
        href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-endpoints"
        rel="external">
        공식 문서
      </a>
      를 참고해 주세요!
    </p>
  </article>
</Post>
