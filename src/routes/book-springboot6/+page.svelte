<!-- auto-generated by QWER -->
<script lang="ts">
  /* eslint-disable @typescript-eslint/ban-ts-comment */
  // @ts-nocheck
  import Post from '$lib/layouts/post.svelte';
  import ImgZoom from '$lib/components/image_zoom.svelte';
  import Video from '$lib/components/video.svelte';
  import CodeCopy from '$lib/components/code_copy.svelte';
  import InfoBox from '$lib/components/info_box.svelte';
</script>

<Post>
  <article slot="post_content">
    <blockquote>
      <p>
        <a
          href="https://ridibooks.com/books/1160000073?_s=search&amp;_q=%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8+%ED%95%B5%EC%8B%AC&amp;_rdt_sid=search&amp;_rdt_idx=0"
          rel="external">
          스프링부트 핵심가이드
        </a>
        을 읽고 정리한 내용입니다.
      </p>
      <p>위 책의 Part 8를 읽고 정리한 내용을 다루고 있습니다.</p>
    </blockquote>
    <h1 id="part-8-spring-data-jpa"><a href="#part-8-spring-data-jpa">Part 8. Spring Data JPA 활용</a></h1>
    <h2 id="query"><a href="#query">@Query 어노테이션 사용하기</a></h2>
    <p>
      <code class="inline-code-block">@Query</code>
       어노테이션을 사용하면 메서드에 직접 JPQL의 쿼리를 정의할 수 있습니다.
    </p>
    <div class="code-block titled showLineNumber">
      <h2 class="code-title">UserRepository.java</h2>
      <CodeCopy>
        <pre><code
            class="language-java">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="line-number">1</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">2</span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">"SELECT u FROM User u WHERE u.name = ?1"</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">3</span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token function">findByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">4</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">}</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      위와 같이 메서드에 <code class="inline-code-block">@Query</code>
       어노테이션을 사용하면 메서드에 정의한 쿼리가 실행됩니다.
    </p>
    <p>
      <code class="inline-code-block">@Query</code>
      어노테이션을 사용할 때 주의할 점은 메서드의 파라미터를 쿼리에 바인딩할 때
      <code class="inline-code-block">?1</code>
      ,
      <code class="inline-code-block">?2</code>
      와 같이 위치 기반으로 바인딩해야 합니다.
    </p>
    <p>
      <code class="inline-code-block">@Param</code>
       어노테이션을 사용하면 파라미터의 이름을 쿼리에 바인딩할 수 있습니다.
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-java">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">"SELECT u FROM User u WHERE u.name = :name"</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> <span class="token function">findByName</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <h2 id="querydsl"><a href="#querydsl">QueryDSL 적용하기</a></h2>
    <p>
      앞에서는 <code class="inline-code-block">@Query</code>
      어노테이션을 사용하여 직접 JPQL의 쿼리를 작성하는 방법을 알아봤습니다. 메서드의 이름을 기반으로 생성하는 JPQL의
      한계는
      <code class="inline-code-block">@Query</code>
       어노테이션을 통해 대부분 해소할 수 있지만, 직접 문자열을 입력하기 때문에 컴파일 시점에 에러를 잡지 못하고 런타임 에러가
      발생할 수 있습니다.
    </p>
    <p>
      이 같은 문제를 해결하기 위해 사용되는 것이 <code class="inline-code-block">QueryDSL</code>
      입니다.
      <code class="inline-code-block">QueryDSL</code>
      은 JPQL을 자바 코드로 작성할 수 있도록 도와주는 라이브러리입니다.
    </p>
    <h3 id="querydsl"><a href="#querydsl">QueryDSL이란?</a></h3>
    <p>
      <code class="inline-code-block">QueryDSL</code>
      은 정적 타입을 이용해 SQL과 같은 쿼리를 생성할 수 있도록 지원하는 프레임워크입니다. 문자열이나 XMl 파일을 통해
      쿼리를 작성하는 대신
      <code class="inline-code-block">QueryDSL</code>
      이 제공하는 플루언트 API를 활용해 쿼리를 생성할 수 있습니다.
    </p>
    <h3 id="querydsl"><a href="#querydsl">QueryDSL의 장점</a></h3>
    <ul>
      <li>IDE가 제공하는 코드 자동 완성 기능을 사용할 수 있습니다.</li>
      <li>문법적으로 잘못된 쿼리를 허용하지 않습니다.</li>
      <li>고정된 SQL 쿼리를 작성하지 않기 떄문에 동적으로 쿼리를 생성할 수 있습니다.</li>
      <li>코드로 작성하므로 가독성 및 생산성이 향상됩니다.</li>
      <li>도메인 타입과 프로퍼티를 안전하게 참조할 수 있습니다.</li>
    </ul>
    <h3 id="querydsl"><a href="#querydsl">QueryDSL을 사용하기 위한 프로젝트 설정</a></h3>
    <p><del>생략</del></p>
    <h3 id="querydsl"><a href="#querydsl">기본적인 QueryDSL 사용하기</a></h3>
    <p>우선 테스트 코드로 기본적인 사용법을 알아보겠습니다.</p>
    <div class="code-block titled showLineNumber">
      <h2 class="code-title">QuerydslTest.java</h2>
      <CodeCopy>
        <pre><code
            class="language-java">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="line-number">1</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token annotation punctuation">@PersistenceContext</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">2</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token class-name">EntityManager</span> entityManager<span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">3</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">4</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token annotation punctuation">@Test</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">5</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">void</span> queryDslTest <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">6</span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token class-name">JPAQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">></span></span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JPAQuery</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>entityManager<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">7</span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token class-name">QProduct</span> qProduct <span class="token operator">=</span> <span class="token class-name">QProduct</span><span class="token punctuation">.</span>product<span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">8</span><span class="no-line-diff"></span></div><div class="code-content">  </div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">9</span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">></span></span> productList <span class="token operator">=</span> query</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">10</span><span class="no-line-diff"></span></div><div class="code-content">                                <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>qProduct<span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">11</span><span class="no-line-diff"></span></div><div class="code-content">                                <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>qProduct<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">12</span><span class="no-line-diff"></span></div><div class="code-content">                                <span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span>qProduct<span class="token punctuation">.</span>price<span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">13</span><span class="no-line-diff"></span></div><div class="code-content">                                <span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">14</span><span class="no-line-diff"></span></div><div class="code-content">  </div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">15</span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token function">assertThat</span><span class="token punctuation">(</span>productList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">16</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">}</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      위 코드는 <code class="inline-code-block">Product</code>
      엔티티의
      <code class="inline-code-block">name</code>
      이
      <code class="inline-code-block">test</code>
      인 데이터를
      <code class="inline-code-block">price</code>
      의 내림차순으로 조회하는 코드입니다.
    </p>
    <p>
      우선 QueryDSL을 사용하기 위해선 JPAQuery 객체를 사용합니다. JPAQuery 객체는 <code class="inline-code-block">
        EntityManager
      </code>
      를 활용해 생성할 수 있습니다. 이렇게 생성된 JPAQuery 객체는 빌더 형식으로 쿼리를 작성할 수 있습니다.
    </p>
    <p>
      List타입으로 값을 리턴받기 위해서는 <code class="inline-code-block">fetch&lpar;&rpar;</code>
      메서드를 사용해야 하는데, 만약 4.0.1이전 버전의 QueryDSL을 사용한다면
      <code class="inline-code-block">list&lpar;&rpar;</code>
       메서드를 사용해야 합니다. 반환 메서드로 사용할 수 있는 메서드는 다음과 같습니다.
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code>{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">- List&lt;T&gt; fetch() : 리스트로 결과를 반환합니다.</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">- T fetchOne : 단건 결과를 반환합니다.</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">- T fetchFirst() : limit(1).fetchOne()과 같습니다.</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>위 예제처럼 JPAQuery 객체를 사용하는 방법 외에 다른 방법도 있습니다.</p>
    <div class="code-block titled showLineNumber">
      <h2 class="code-title">QuerydslTest.java</h2>
      <CodeCopy>
        <pre><code
            class="language-java">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="line-number">1</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token annotation punctuation">@Test</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">2</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">void</span> queryDslTest2 <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">3</span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token class-name">JPAQueryFactory</span> jpaQueryFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JPAQueryFactory</span><span class="token punctuation">(</span>entityManager<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">4</span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token class-name">QProduct</span> qProduct <span class="token operator">=</span> <span class="token class-name">QProduct</span><span class="token punctuation">.</span>product<span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">5</span><span class="no-line-diff"></span></div><div class="code-content">  </div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">6</span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">></span></span> productList <span class="token operator">=</span> jpaQueryFactory<span class="token punctuation">.</span><span class="token function">selectFrom</span><span class="token punctuation">(</span>qProduct<span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">7</span><span class="no-line-diff"></span></div><div class="code-content">                                <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>qProduct<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">8</span><span class="no-line-diff"></span></div><div class="code-content">                                <span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span>qProduct<span class="token punctuation">.</span>price<span class="token punctuation">.</span><span class="token function">desc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">9</span><span class="no-line-diff"></span></div><div class="code-content">                                <span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">10</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">}</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      위 예제에서는 <code class="inline-code-block">JPAQueryFactory</code>
      를 활용해 쿼리를 작성합니다.
      <code class="inline-code-block">JPAQuery</code>
      와 달리 select절부터 작성 가능합니다. 만약 전체 컬럼이 아닌 일부만 조회하고 싶다면 select()와 from() 메서드를
      구분하여 사용하면 됩니다.
    </p>
    <h3 id="querydslpredicateexecutor"><a href="#querydslpredicateexecutor">QuerydslPredicateExecutor</a></h3>
    <p>
      Spring data JPA에서는 QueryDSL을 더욱 편하게 사용할 수 있도록 <code class="inline-code-block">
        QuerydslPredicateExecutor
      </code>
       인터페이스를 제공합니다.
    </p>
    <p>
      <code class="inline-code-block">QuerydslPredicateExecutor</code>
      인터페이스는
      <code class="inline-code-block">JpaRepository</code>
      와 함께 리포지토리에서 상속받아 사용할 수 있습니다.
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-java">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">QProductRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">></span></span> <span class="token punctuation">,</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token class-name">QuerydslPredicateExecutor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">}</span>  </div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      <code class="inline-code-block">QuerydslPredicateExecutor</code>
      인터페이스는
      <code class="inline-code-block">Predicate</code>
      타입의 파라미터를 받아 동적으로 쿼리를 생성합니다.
      <code class="inline-code-block">Predicate</code>
      는 표현식을 작성할 수 있게 QueryDSL에서 제공하는 인터페이스입니다.
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-java">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token class-name">Predicate</span> predicate<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Predicate</span> predicate<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Predicate</span> predicate<span class="token punctuation">,</span> <span class="token class-name">Sort</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Predicate</span> predicate<span class="token punctuation">,</span> <span class="token class-name">OrderSpecifier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> orders<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">OrderSpecifier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> orders<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Predicate</span> predicate<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pagealbe<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">long</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token class-name">Predicate</span> predicate<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">boolean</span> <span class="token function">exists</span><span class="token punctuation">(</span><span class="token class-name">Predicate</span> predicate<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      <code class="inline-code-block">Predicate</code>
      를 이용해 findOne() 메서드를 호출하는 방법은 아래와 같습니다.
    </p>
    <div class="code-block titled showLineNumber">
      <h2 class="code-title">QuerydslTest.java</h2>
      <CodeCopy>
        <pre><code
            class="language-java">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="line-number">1</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token annotation punctuation">@Test</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">2</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">3</span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token class-name">Predicate</span> predicate <span class="token operator">=</span> <span class="token class-name">QProduct</span><span class="token punctuation">.</span>product<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">containsIgnoreCase</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">4</span><span class="no-line-diff"></span></div><div class="code-content">                        <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token class-name">QProduct</span><span class="token punctuation">.</span>product<span class="token punctuation">.</span>price<span class="token punctuation">.</span><span class="token function">betwwen</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">2500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">5</span><span class="no-line-diff"></span></div><div class="code-content">  </div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">6</span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">></span></span> product <span class="token operator">=</span> productRepository<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>predicate<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">7</span><span class="no-line-diff"></span></div><div class="code-content">  </div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">8</span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token function">assertThat</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isNotNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">9</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">}</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      이처럼 <code class="inline-code-block">Predicate</code>
      는 간단하게 표현식으로 정의하는 쿼리로 생각하면 됩니다. 하지만 join이나 fetch 등의 기능은 사용할 수 없다는 단점이
      있습니다.
    </p>
    <h3 id="jpa-auditing"><a href="#jpa-auditing">[한걸음 더] JPA Auditing 적용</a></h3>
    <p>
      JPA에서 Audit이란 감시하다라는 뜻으로, 각 데이터마다 누가,언제 데이터를 생성했고 변경했는지 감시한다는 의미로
      사용됩니다. 엔티티 클래스에는 공통적으로 들어가는 필드가 있습니다. 예를 들어, 생성일자와 변경일자 같은 것입니다.
      Spring Data JPA에서는 이러한 값을 자동으로 넣어주는 기능을 제공합니다.
    </p>
    <h4 id="jpa-auditing"><a href="#jpa-auditing">JPA Auditing 기능 활성화</a></h4>
    <p>
      <code class="inline-code-block">@EnableJpaAuditing</code>
       어노테이션을 사용하면 JPA Auditing 기능을 활성화할 수 있습니다.
    </p>
    <div class="code-block titled">
      <h2 class="code-title">Application.java</h2>
      <CodeCopy>
        <pre><code
            class="language-java">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token comment">/// showLineNumber </span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token annotation punctuation">@SpringBootApplication</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token annotation punctuation">@EnableJpaAuditing</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token punctuation">}</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">}</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      위와 같이 어노테이션을 추가하면 정상적으로 기능이 활성화되지만, 테스트하는 일부 코드에서 에러가 발생할 수
      있습니다. 예를 들면, @WebMvcTest 어노테이션을 지정해서 테스트를 수행하는 코드를 작성하면 애플리케이션 클래스를
      호출하는 과정에서 예외가 발생할 수 있습니다. 이 같은 문제를 해결하기 위해 별도의 Configuration 클래스를 생성해서
      애플리케이션 클래스의 기능과 분리해서 활성화 할 수 있습니다.
    </p>
    <div class="code-block titled showLineNumber">
      <h2 class="code-title">JpaConfig.java</h2>
      <CodeCopy>
        <pre><code
            class="language-java">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="line-number">1</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token annotation punctuation">@Configuration</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">2</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token annotation punctuation">@EnableJpaAuditing</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">3</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JpaConfig</span> <span class="token punctuation">{</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">4</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">}</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <h4 id="baseentity"><a href="#baseentity">BaseEntity 만들기</a></h4>
    <div class="code-block titled showLineNumber">
      <h2 class="code-title">BaseEntity.java</h2>
      <CodeCopy>
        <pre><code
            class="language-java">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="line-number">1</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token annotation punctuation">@Getter</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">2</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token annotation punctuation">@Setter</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">3</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token annotation punctuation">@ToString</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">4</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token annotation punctuation">@MappedSuperclass</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">5</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token annotation punctuation">@EntityListeners</span><span class="token punctuation">(</span><span class="token class-name">AuditingEntityListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">6</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseEntity</span> <span class="token punctuation">{</span> </div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">7</span><span class="no-line-diff"></span></div><div class="code-content">    </div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">8</span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token annotation punctuation">@CreatedDate</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">9</span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token annotation punctuation">@Colmn</span><span class="token punctuation">(</span>updateable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">10</span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token annotation punctuation">@private</span> <span class="token class-name">LocalDAteTime</span> createdAt<span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">11</span><span class="no-line-diff"></span></div><div class="code-content">  </div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">12</span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token annotation punctuation">@LastModifiedDate</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">13</span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> updatedAt<span class="token punctuation">;</span></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">14</span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">}</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <ul>
      <li>
        <code class="inline-code-block">@MappedSuperclass</code>
         : 테이블과 매핑되지 않고 자식 클래스에게 매핑 정보만 제공하는 어노테이션입니다.
      </li>
      <li>
        <code class="inline-code-block">@EntityListeners</code>
         : 엔티티의 생명주기를 감시하는 리스너를 설정하는 어노테이션입니다.
      </li>
      <li>
        <code class="inline-code-block">@CreatedDate</code>
         : 엔티티가 생성되어 저장될 때 시간 정보를 자동으로 저장하는 어노테이션입니다.
      </li>
      <li>
        <code class="inline-code-block">@LastModifiedDate</code>
         : 엔티티가 수정될 때 시간 정보를 자동으로 저장하는 어노테이션입니다.
      </li>
    </ul>
    <p>위 BaseEntity를 이용하여 Product 엔티티를 수정해보겠습니다.</p>
    <div class="code-block titled">
      <h2 class="code-title">Product.java</h2>
      <CodeCopy>
        <pre><code
            class="language-java">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token keyword">extends</span> <span class="token class-name">BaseEntity</span> <span class="token punctuation">{</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">}</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>이렇게 BaseEntity를 상속받으면 Product 엔티티에는 createdAt과 updatedAt 필드가 추가됩니다.</p>
  </article>
</Post>
